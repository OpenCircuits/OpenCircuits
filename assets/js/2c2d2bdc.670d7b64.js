"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[55],{1644:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"Other/References/Analog/UsingNGSpice","title":"Using NGSpice","description":"Team","source":"@site/../../../../docs/Other/References/Analog/UsingNGSpice.md","sourceDirName":"Other/References/Analog","slug":"/Other/References/Analog/UsingNGSpice","permalink":"/Other/References/Analog/UsingNGSpice","draft":false,"unlisted":false,"editUrl":"https://github.com/OpenCircuits/OpenCircuits/edit/master/docs/Other/References/Analog/UsingNGSpice.md","tags":[],"version":"current","frontMatter":{"title":"Using NGSpice"},"sidebar":"otherSidebar","previous":{"title":"Fall 2019 Research","permalink":"/Other/References/Analog/Fall2019Research"},"next":{"title":"GAuth Setup","permalink":"/Other/References/GAuthSetup"}}');var s=i(2295),o=i(8002);const r={title:"Using NGSpice"},l=void 0,a={},c=[{value:"Team",id:"team",level:2},{value:"Resources",id:"resources",level:2},{value:"Compiling with Linux",id:"compiling-with-linux",level:2},{value:"Compiling with MinGW32 / MSYS2",id:"compiling-with-mingw32--msys2",level:2},{value:"Coding with NGSpice",id:"coding-with-ngspice",level:2},{value:"Creating Netlists",id:"creating-netlists",level:2},{value:"NGSpice Commands",id:"ngspice-commands",level:2}];function d(e){const n={a:"a",br:"br",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"team",children:"Team"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Evan Cama"}),"\n",(0,s.jsx)(n.li,{children:"Andrew Barton"}),"\n",(0,s.jsx)(n.li,{children:"Robert Hammond"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"http://ngspice.sourceforge.net/docs/ngspice-manual.pdf",children:"NGSpice user manual"}),(0,s.jsx)(n.br,{}),"\n","Important chapters: 19, 32"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"http://ngspice.sourceforge.net/shared.html",children:"NGSpice Shared Library"}),(0,s.jsx)(n.br,{}),"\n","This contains a large number of links to numerous uses of the NGSpice library.",(0,s.jsx)(n.br,{}),"\n","The ones we are currently interested in are the C Language console applications. Clicking ",(0,s.jsx)(n.a,{href:"http://ngspice.sourceforge.net/ngspice-shared-lib/ngspice_cb.7z",children:"this sourceforge link"})," will automatically download these applications for you.",(0,s.jsx)(n.br,{}),"\n","You will also need the ngspice.dll file. ",(0,s.jsx)(n.a,{href:"http://ngspice.sourceforge.net/ngspice-shared-lib/ngspice-sh_bin_win32.7z",children:"This"})," is the sourceforge link for the 32-bit version, while ",(0,s.jsx)(n.a,{href:"http://ngspice.sourceforge.net/ngspice-shared-lib/ng_start64_binaries.7z",children:"this"})," is the sourceforge link for the 64-bit version."]}),"\n",(0,s.jsx)(n.p,{children:"The ngspice_cb directory contains 2 methods of linking to the NGSpice library. Either you can link to the library dynamically during runtime, or you can link to it statically during compilation. For our methods, we will likely do the latter. This directory also contains convenient folders with Visual Studio project files, making it much easier to traverse these examples."}),"\n",(0,s.jsx)(n.h2,{id:"compiling-with-linux",children:"Compiling with Linux"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"http://ngspice.sourceforge.net/docs/ngspice-manual.pdf#chapter.32",children:"Compiling NGSpice, according to the manual"}),(0,s.jsx)(n.br,{}),"\n","The manual gives a (probably) good explanation on how to compile NGSpice. For now, we are testing everything on 64-bit Linux. Instructions for other operating systems will be added in the future. What follows is just a set of additional notes when following along in the manual."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["In general, required packages can automatically be installed in the terminal with ",(0,s.jsx)(n.code,{children:"sudo apt install packageName"})]}),"\n",(0,s.jsx)(n.li,{children:"Packages to install: ngspice, bison, flex, libx11-6, libx11-dev, libxaw7, libxaw7-dev, libfftw3-3, libreadline8, libreadline-dev, and gcc-multilib. If installing from git, also install autoconf, automake, and libtool."}),"\n",(0,s.jsxs)(n.li,{children:["Link to the specific tarball folder ",(0,s.jsx)(n.a,{href:"https://sourceforge.net/projects/ngspice/files/ng-spice-rework/32/ngspice-32.tar.gz/download",children:"here"}),". We may want to go through the tarball installation instead of using the Git, as the Git is still under development and may be unstable. The tarball is the official released distribution."]}),"\n",(0,s.jsxs)(n.li,{children:["When installing for a tarball, the manual gives a ./configure command to run. In addition to the flags listed, also include the flag --with-ngshared. This will actually create the shared library that we will need to use later. The command should look like ",(0,s.jsx)(n.code,{children:"./configure --enable-xspice --disable-debug --with-readline=yes --with-ngshared"})]}),"\n",(0,s.jsx)(n.li,{children:'When running that ./configure command, you may get an error at the end of runtime that reads "configure: error: Couldn\'t find GNU readline headers." If this is the case, your system itself is missing the readline.h header. You may need the lib64readline-dev package.'}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Section 32.2.1 of the user manual explains building ngspice with MS Visual Studio."}),"\n",(0,s.jsxs)(n.p,{children:["[Where the package files are]\r\nAfter you run ",(0,s.jsx)(n.code,{children:"sudo make install"}),", the package's files will be installed in ",(0,s.jsx)(n.code,{children:"/usr/local/bin"}),", ",(0,s.jsx)(n.code,{children:"/usr/local/man"}),", ",(0,s.jsx)(n.code,{children:"/usr/local/lib"}),", ",(0,s.jsx)(n.code,{children:"/usr/local/share"}),", and ",(0,s.jsx)(n.code,{children:"/usr/local/include"}),". The shared object file(s) ",(0,s.jsx)(n.code,{children:"libngspice.so"})," is located in ",(0,s.jsx)(n.code,{children:"/usr/local/lib"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["[Linking the libngspice.so files]",(0,s.jsx)(n.br,{}),"\n","cd over to the folder /usr/local/lib and run the following commands:",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"file libngspice.so"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"file libngspice.so.0.0.0"})]}),"\n",(0,s.jsxs)(n.p,{children:["[Running the test program]\r\nAfter installing ngspice, you can compile and run the test program of ngspice_cb. As mentioned in compile-linux-new.txt, you will have to run the following command in the ",(0,s.jsx)(n.code,{children:"ngspice_cb"})," directory:",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"export LD_LIBRARY_PATH=/lib:/usr/lib:/usr/local/lib"}),(0,s.jsx)(n.br,{}),"\n","For static linking of ngspice,",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"cd ng_shared_test_sl"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"gcc main.c -m32 -Wall -s -lngspice -lpthread -ldl -o ./bin/Debug/ng_sh"}),(0,s.jsx)(n.br,{}),"\n",'This may give you a compilation error "unable to find -lngspice". To fix this, add the ',(0,s.jsx)(n.code,{children:"-L"})," flag to the gcc command:",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"gcc main.c -L -m32 -Wall -s -lngspice -lpthread -ldl -o ./bin/Debug/ng_sh"}),(0,s.jsx)(n.br,{}),"\n","Additionally, you may need to cd into ng_shared_test_dl/bin/Debug and run the command ",(0,s.jsx)(n.code,{children:"sudo ln -s /usr/local/lib/libngspice.so.0.0.0 /usr/local/lib/libngspicelib.so"})]}),"\n",(0,s.jsx)(n.h2,{id:"compiling-with-mingw32--msys2",children:"Compiling with MinGW32 / MSYS2"}),"\n",(0,s.jsxs)(n.p,{children:["The shared library can be compiled using the MSYS2 shell in Windows, which can be installed and set up using this ",(0,s.jsx)(n.a,{href:"https://github.com/orlp/dev-on-windows/wiki/Installing-GCC--&-MSYS2",children:"helpful guide"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"pacman -S gcc libtool autoconf automake bison git make\r\ngit clone git://git.code.sf.net/p/ngspice/ngspice\r\ncd ngspice\r\n./compile_min_shared.sh\n"})}),"\n",(0,s.jsx)(n.p,{children:"You may get an error: unknown type 'CRITICAL_SECTION', to which the solution is currently unknown."}),"\n",(0,s.jsx)(n.h2,{id:"coding-with-ngspice",children:"Coding with NGSpice"}),"\n",(0,s.jsx)(n.p,{children:"The test program described above is a good example of how to interact with the NGSpice library. The following is an explanation on how it works/how to develop your own code. Much of this information, such as more detailed explanation of the callback functions, can also be found in section 19.3 of the NGSpice manual."}),"\n",(0,s.jsxs)(n.p,{children:["The first thing you must do is call the function ",(0,s.jsx)(n.code,{children:"ngSpice_Init(SendChar*, SendStat*, ControlledExit*, SendData*, SendInit-Data*, BGThreadRunning*, void)"}),", which takes in as input several callback functions. These functions, which must be defined and implemented by the user, are called within the NGSpice code. Their purpose to allow the library to send data back up to the user. The int return value is not used."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SendChar(char* outputreturn, int ident, void* userdata)"})," is the function that will be called whenever NGSpice wants to print information to the console, i.e. stdout or stderr. This function can be as simple as a single printf statement, such as ",(0,s.jsx)(n.code,{children:'printf("%s\\n", outputreturn);'}),", in addition to any necessary error checking."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SendStat(char* outputreturn, int ident, void* userdata)"}),' is identical to SendChar, except it\'s called whenever NGSpice prints raw data to the console. i.e. when it prints "tran: 5.0%" to the console in the test code.']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ControlledExit(int exitstatus, bool immediate, bool quitexit, int ident, void* userdata)"}),' is called whenever NGSpice does a controlled exit, i.e. the "exit" command.']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SendData(pvecvaluesall vdata, int numvecs, int ident, void* userdata)"})," is called whenever NGSpice changes a single data point during an operation. This allows the user to update any structs that may be stored on their end. This function consequently gets called a lot. Note that NGSpice stores data as a struct."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SendInit-Data(pvecinfoall intdata, int ident, void* userdata)"})," is used to initialize the data vectors that NGSpice will be operating on."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"BGThreadRunning(bool noruns, int ident, void* userdata)"})," is used by NGSpice to update the user if a background thread is running or not."]}),"\n",(0,s.jsx)(n.li,{children:'The final input can be the object address of the calling function, i.e. "self" or "this". It\'s also perfectly fine to use NULL for this value.'}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["After you call the ngSpice_Init function, it's surprisingly simple to work with the library. Simply call ",(0,s.jsx)(n.code,{children:"ngSpice_Command(char*)"}),' with a command as the input, and NGSpice handles the rest. It returns \'1\' upon an error, \'0\' otherwise. The input would be exactly like what you may put in when running NGSpice in the terminal, such "source ./adder_mos_2.cir", "tran 500p 6400NS", or even "help --all". Note that instead of calling ',(0,s.jsx)(n.code,{children:'ngSpice_Command("run")'}),', you can call ``ngSpice_Command("bg_run"), which causes NGSpice to run the operation in a background thread. Just make sure not to prematurely shut off the operation. The rest of the functions that can be called are detailed in chapter 19.3 of the manual.']}),"\n",(0,s.jsx)(n.h2,{id:"creating-netlists",children:"Creating Netlists"}),"\n",(0,s.jsx)(n.p,{children:"A netlist can be created using any text editor. There are two required lines to be included in a netlist. The first line must be a title line (Note: no special syntax or formatting needed), and the last line of the netlist must be .end. The lines in between can either be comments, control lines, or circuit element lines. The control lines will tell the simulator which model and run parameters to perform. The circuit element lines will add different circuit components to the simulation."}),"\n",(0,s.jsx)(n.h2,{id:"ngspice-commands",children:"NGSpice Commands"}),"\n",(0,s.jsxs)(n.p,{children:['There are a wide range of commands that will work with NGSpice once a netlist has been loaded into the program. Once the desired netlist has been created, it must be loaded into NGspice. In order to load a netlist into NGSpice, the user must first be in the correct directory. Terminal commands can be used in NGSpice to get into the right directory (ie. cd <DirectoryName>). Once in the proper directory, in order to load the netlist into NGSpice, use the command: source <filename>. Once the netlist is loaded in properly, then the user will be able type "run" into the command line and results from the netlist will be shown. A good example netlist to look at is the file ',(0,s.jsx)(n.a,{href:"https://github.com/OpenCircuits/OpenCircuits/blob/UnitTests/app/analog/ts/Sample%20Netlists/voltdiv.sp",children:"voltdiv.sp"}),". This is a simple voltage divider circuit that will display the vin and vout voltages when run with NGSpice."]}),"\n",(0,s.jsxs)(n.p,{children:["Here is a list of some commands that can be run with NGSpice (reference source: ",(0,s.jsx)(n.a,{href:"https://esim.fossee.in/ngspicecmd",children:"https://esim.fossee.in/ngspicecmd"}),"):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"help - It opens NGSpice manual and gives information about all NGSpice commands."}),"\n",(0,s.jsx)(n.li,{children:"listing - It prints the current netlist of the circuit."}),"\n",(0,s.jsx)(n.li,{children:"print v(out) or print v(3) - It prints the voltage values of corresponding node name or node number."}),"\n",(0,s.jsx)(n.li,{children:"plot v(out) or plot v(3) - It plots the voltage values of corresponding node name or node number."}),"\n",(0,s.jsx)(n.li,{children:"plot v(in1, in2) or print v(2,1) - It plots the voltage difference of two nodes."}),"\n",(0,s.jsx)(n.li,{children:"plot v(in1) - v(in2) or print v(2) - v(1) - It plots or prints the voltage difference of two nodes."}),"\n",(0,s.jsx)(n.li,{children:"plot v(in1) + v(in2) or print v(2) + v(1) - It plots or prints the voltage addition of two nodes."}),"\n",(0,s.jsx)(n.li,{children:"plot v(in1) * v(in2) or print v(2) * v(1) - It plots or prints the voltage multiplication of two nodes."}),"\n",(0,s.jsx)(n.li,{children:"plot v(in1) / v(in2) or print v(2) / v(1) - It plots or prints the voltage division of two nodes."}),"\n",(0,s.jsx)(n.li,{children:"plot i(vs) or print i(v1)- It prints the current values of corresponding branch. Here we have connect 0v voltage source in series(vs or v1),to find current in particular branch."}),"\n",(0,s.jsx)(n.li,{children:"plot i(v2) or plot i(vout) - It plots the current values of corresponding branch. Here we have connect 0v voltage source in series(vs or v1),to find current in particular branch."}),"\n",(0,s.jsx)(n.li,{children:"plot mag(v(2)) or print mag(v(2)) - It plots or prints magnitude values of corresponding node."}),"\n",(0,s.jsx)(n.li,{children:"plot db(v(2)) or print db(v(2)) - It plots or prints voltage values of corresponding node in decibel."}),"\n",(0,s.jsx)(n.li,{children:"plot imag(v(2)) or print imag(v(2)) - It plots or prints imaginary part of voltage values of corresponding node."}),"\n",(0,s.jsx)(n.li,{children:"plot phase(v(2)) or print phase(v(2))- It plots or prints phase values of corresponding node in radian."}),"\n",(0,s.jsxs)(n.li,{children:["plot 180/PI",(0,s.jsx)(n.em,{children:"phase(v(2)) or print 180/PI"}),"phase(v(2)) - It plots or prints phase values of corresponding node in degree."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:'There is still work being done to try and figure out how all these commands can be used without errors. Research is aimed toward continuing to learn how different outputs can be found and used. One current error message that is popping up when a plot command is run with NGSPice is "Can\'t open viewport for graphics."'})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8002:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>l});var t=i(8431);const s={},o=t.createContext(s);function r(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);